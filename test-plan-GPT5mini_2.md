# HOTEL PLANISPHERE — テストプラン（詳細版）

作成日: 2025-10-27

対象サイト: https://hotel-example-site.takeyaqa.dev/ja/

概要
----
この文書は HOTEL PLANISPHERE の日本語サイトに対する実務的なテストプランです。主要なユーザージャーニー（検索 → プラン閲覧 → 予約 → ログイン → マイページ）をカバーし、ハッピーパス、入力バリデーション、エラー処理、境界値、アクセシビリティ、非機能要件を含む詳細なテストシナリオを提供します。

前提と共通設定
----------------
- テストはクリーンなブラウザプロファイルで実行する（ローカルストレージ・セッション・クッキーは空の状態）。
- テストユーザー: `ichiro@example.com` / `password123`（存在するテストアカウントを想定）。
- テストデータは並列実行で競合しないように管理する。必要ならテスト専用のプラン/ユーザを用意する。
- 想定ブラウザ: Chromium（Playwright を用いる場合は Playwright のデフォルト設定に従う）。

成功基準
--------
- 指定の入力に対して期待通りの UI 表示とサーバー応答が確認できること。
- 入力エラーは適切なエラーメッセージでユーザーに伝達されること。
- 予約フローでは合計金額の計算が正しく行われ、確認・確定が可能であること。

メインユーザーフロー（重要パス）
--------------------
1. トップページ表示
2. プラン検索（宿泊日・人数など）
3. プラン詳細閲覧
4. 予約フォーム入力 → 確認 → 確定
5. ログイン / マイページ確認

テストシナリオ詳細
------------------
各シナリオは独立して実行できるよう state をリセットして開始します。各ケースは「前提（Seed）」「手順」「期待結果」「成功/失敗条件」を含みます。

### シナリオ 1 — トップページ表示の確認
前提: 新規ブラウザ（クッキー/ローカルストレージ無し）
手順:
1. サイトにアクセスする: `https://hotel-example-site.takeyaqa.dev/ja/`
2. ページ上部のロゴ/ヘッダーが表示されていることを確認
3. メインの宿泊プラン一覧（少なくとも 1 件）が表示されていることを確認
期待結果:
- HTTP 200 でページが読み込まれる
- ロゴ、検索フォーム、プラン一覧、フッターが表示される
成功条件: 以上の要素が徒歩的に確認できる
失敗条件: レイアウト崩れ、主要要素欠落、HTTP エラー

### シナリオ 2 — プラン検索（ハッピーパス）
前提: トップページを表示
手順:
1. "宿泊日" フィールドに将来の日付を入力
2. 宿泊人数を 1 に設定
3. "検索" または該当の実行ボタンをクリック
期待結果:
- 検索結果ページが表示され、選択条件に合うプランが一覧される
- 絞り込み条件が UI に表示される
成功条件: 検索結果に少なくとも 1 件表示される
失敗条件: 結果が空なのに該当プランが存在する、またはフロントでエラー

### シナリオ 3 — プラン詳細の検証
前提: 検索結果またはトップページのプラン一覧から任意のプランを選択
手順:
1. プランタイトルをクリックして詳細ページへ遷移
2. プランの説明、価格、設備、予約ボタンが存在することを確認
期待結果:
- 詳細ページが読み込まれ、価格・設備・予約ボタンが視認可能
成功条件: 主要情報（料金、宿泊可能日、部屋タイプ）が表示される

### シナリオ 4 — 予約フォーム：必須項目バリデーション
前提: プラン詳細ページ
手順:
1. 予約ボタンを押して予約フォームを表示
2. 氏名・メール等を空のまま「予約内容を確認する」をクリック
期待結果:
- 各必須フィールドに対して適切なバリデーションメッセージが表示される
成功条件: サーバーに不正な空データが送信されず、UI側で阻止される

### シナリオ 5 — 予約作成（ハッピーパス）
前提: プラン詳細ページ
手順:
1. 宿泊日、宿泊数、人数を入力
2. 氏名、メールアドレス、連絡方法を入力
3. オプション（朝食など）を選択
4. "予約内容を確認する" をクリック
5. 確認画面で内容を検証し、"予約を確定する" をクリック
期待結果:
- 確認画面に入力値が反映される
- 予約確定後、予約番号または完了メッセージが表示される
成功条件: 予約完了ページが表示され、バックエンドに予約レコードが作成される
失敗条件: 合計金額が '-' のまま、確定ボタンが機能しない、エラー画面

### シナリオ 6 — 予約合計（計算ロジック）検証
前提: 予約フォームが表示される状態
手順:
1. ベース料金が分かるプランを選ぶ
2. 宿泊日数や人数、オプションを変えながら合計金額が動的に更新されるか確認
期待結果:
- 入力値に応じた合計金額が即時に表示される
- 計算が正しい（簡単な手計算で検算）
成功条件: 計算ミスがないこと

### シナリオ 7 — ログイン（正常系/異常系）
前提: トップページ
手順（正常系）:
1. ログイン画面に遷移
2. 正しいメールとパスワードを入力してログイン
期待結果（正常系）:
- マイページに遷移し、ユーザー名・会員情報が表示される
手順（異常系）:
1. 誤ったパスワード／存在しないメールでログインを試行
期待結果（異常系）:
- ログインは拒否され、適切なエラーメッセージを表示する

### シナリオ 8 — マイページ：予約履歴確認
前提: ログイン済み
手順:
1. マイページへ遷移
2. 予約履歴や会員情報が表示されることを確認
期待結果:
- 予約履歴に直近の予約が表示される（予約確定後に確認）

### シナリオ 9 — セッション／認証ガード
前提: 認証を必要とするページ（マイページなど）
手順:
1. 未ログイン状態でマイページへ直接アクセス
期待結果:
- ログインページへリダイレクトされる

### シナリオ 10 — 攻撃的入力（セキュリティ）
前提: フォーム入力フィールド
手順:
1. 入力フィールドに簡易的な攻撃文字列（`<script>alert(1)</script>` や SQL の ' OR '1'='1）を入力して送信
期待結果:
- サイトが適切にサニタイズまたは拒否する。XSS が実行されないこと

### シナリオ 11 — アクセシビリティ簡易チェック
目的: キーボード操作・スクリーンリーダーに対する基本的な互換性
手順:
1. キーボードのみでトップページ→検索→プラン詳細→予約フォームへ移動できるか
2. 画像に alt が設定されているか、フォームのラベルが適切かをチェック
期待結果:
- キーボードだけで主要フローを辿れる
- 主要画像に alt 属性、フォームラベルが適切に存在する

### シナリオ 12 — エラー復旧（ネットワーク障害）
前提: ネットワーク断が発生した場合を想定
手順:
1. 予約確定中にネットワーク断をシミュレート（テストツールで応答なし）
2. ネットワーク回復後に再試行できるか確認
期待結果:
- ユーザーに明示的なエラーメッセージを表示
- トランザクションが二重で送信されないように保護されていること

実行手順（Playwright を用いる場合の推奨）
--------------------------
- 各シナリオは Playwright テストで独立した `spec` として実装する。
- 各テストの前に `page.context().clearCookies()` と `page.goto(baseURL)` を行って状態をリセットする。
- 予約に影響するフローはシリアル化して走らせる（あるいは環境を分ける）。

例: 実行コマンド
```bash
# 全テスト実行
npx playwright test

# reservation 関連のみ
npx playwright test tests/reservation.spec.ts --reporter=list
```

報告とログ
-----------
- 各 E2E 実行は Playwright の Trace を有効にして失敗時に trace.zip を保存する。
- 重要な失敗はスクリーンショット、コンソールログ、ネットワークログと一緒に保存する。

付録: 優先度と実行順
-------------------
1. トップページ表示（ブロック要因検出）
2. 検索・プラン表示
3. 予約必須項目バリデーション
4. 予約作成（合計計算の検証を含む）
5. ログイン / マイページ
6. セキュリティ / パフォーマンス / アクセシビリティ検査

以上。必要であればこのテストプランから直接 Playwright 用の `spec` テンプレート（ページオブジェクト付き）を生成します。ご希望があれば続けて自動テストコードを作成します。